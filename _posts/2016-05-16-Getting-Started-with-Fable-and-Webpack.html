---
layout: post
title: "Getting started with Fable and Webpack"
description: "Getting started with Fable (F# to JS compiler), Webpack using Visual Studio Code"
modified: 2016-05-16
tags: [F#, Fable, VSCode, Webpack, JS]
image:
  feature: abstract-6.jpg
---
<h1>Introduction</h1>
<p><a href="https://github.com/fsprojects/Fable">Fable</a> is new F# to JavaScript compiler created by <a href="https://twitter.com/alfonsogcnunez">Alfonso Garcia-Caro</a>. In this post I'll go, step by step, through process of creating client-side (browser) applications using it.</p>
<blockquote>
<p>This post is targeted at F# developers without lot of knowladge about Node.js and JS ecosystem and it should let any F# developer to get started with Fable.</p>
</blockquote>
<h3>Requirements</h3>
<p>Fable requires having both <a href="http://fsharp.org">F# 4</a> and <a href="https://nodejs.org/en/">node 4.4</a> or bigger installed in your computer.</p>
<h1>Setting up project</h1>
<p>The first thing we need to do is creating new directory and initializing node project:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip"><code lang="bash">mkdir fable-test
cd fable-test
npm init
</code></pre></td></tr></table>
<blockquote>
<p><a href="https://www.npmjs.com/">Npm</a> is is the package manager for JavaScript. It lets users to find, share, and reuse packages of code or install additional tools</p>
</blockquote>
<p><code>npm init</code> will create <code>package.json</code> file. This file is project file for any Node.js based project (both client and server side). At start it will contain only basic information about a project, something like that:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
</pre></td>
<td class="snippet"><pre class="fssnip"><code lang="json">{
  "name": "fable-test",
  "version": "1.0.0",
  "description": "",
  "scripts": {
    "test": "..."
  },
  "author": "",
  "license": "MIT",
}
</code></pre></td></tr></table>
<h3>Installing development tools.</h3>
<p>Next step is installing all development dependencies (tools) which we'll be using for our project. To do so we are using <code>npm install</code> command:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip"><code lang="bash">npm install --save-dev fable-compiler
npm install --save-dev webpack
npm install --save-dev source-map-loader
</code></pre></td></tr></table>
<p>First line installs Fable compiler for our project. Second command installs <a href="https://webpack.github.io/">Webpack</a>. Webpack is a module bundler - it takes modules with dependencies and generates static assets representing those modules. In our case it would take generated by Fable files together with other JS libraries we will depend upon and create single file output which can be easily added to page. Last dependency is plugin to Webpack which will enable nice debugging story for our application (debugging F# files in the browser)</p>
<p>It's also worth noticing that those commands modified <code>package.json</code> file, now it contains also following block:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip"><code lang="json">"devDependencies": {
    "fable-compiler": "^0.2.12",
    "source-map-loader": "^0.1.5",
    "webpack": "^1.13.0"
  },
</code></pre></td></tr></table>
<h3>Installing dependencies</h3>
<p>Now we will install our code dependencies using also <code>npm install</code>.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip"><code lang="bash">npm install --save core-js
npm install --save fable-core
</code></pre></td></tr></table>
<p><code>core-js</code> is polyfill ensuring that code generated by Fable will run in any browser. <code>fable-core</code> is standard Fable library.</p>
<p>Those commands again modified <code>package.json</code> file, this time adding following information:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip"><code lang="json">"dependencies": {
    "core-js": "^2.4.0",
    "fable-core": "0.0.21"
  }
</code></pre></td></tr></table>
<h3>Creating F# script and HTML file</h3>
<p>Fable supports both <code>fsproj</code> and plain <code>fsx</code> files. For simplicity in this example let's use <code>fsx</code> file. Create <code>source\code.fsx</code> with follwing content:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
<span class="l">9: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="prep">#r</span> <span class="s">&quot;../node_modules/fable-core/Fable.Core.dll&quot;</span>

<span class="k">open</span> <span class="i">Fable</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="i">Core</span> 
<span class="k">open</span> <span class="i">Fable</span><span class="o">.</span><span class="i">Import</span>
 
<span class="i">Node</span><span class="o">.</span><span class="i">require</span><span class="o">.</span><span class="i">Invoke</span>(<span class="s">&quot;core-js&quot;</span>) <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs2', 2)" onmouseover="showTip(event, 'fs2', 2)" class="i">ignore</span>

<span class="k">let</span> <span class="i">element</span> <span class="o">=</span> <span class="i">Browser</span><span class="o">.</span><span class="i">document</span><span class="o">.</span><span class="i">getElementById</span> <span class="s">&quot;sample&quot;</span>
<span class="i">element</span><span class="o">.</span><span class="i">innerText</span> <span class="o">&lt;-</span> <span class="s">&quot;Hello, world !!&quot;</span>
</code></pre></td>
</tr>
</table>
<p>This code should be pretty straightforward, only tricky part is <code>Node.require.Invoke("core-js")</code> which is importing Node.js module (installed by <code>npm</code>).</p>
<p>Let's also create very simple HTML file <code>public\index.html</code> ( <code>public</code> will be our output folder):</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="html"><span class="k">&lt;!</span><span class="i">doctype</span> <span class="o">html</span><span class="k">&gt;</span>
<span class="k">&lt;</span><span class="i">html</span><span class="k">&gt;</span>
<span class="k">&lt;</span><span class="i">head</span><span class="k">&gt;</span>
  <span class="k">&lt;</span><span class="i">meta</span> <span class="o">http-equiv</span><span class="k">='Content-Type'</span> <span class="o">content</span><span class="k">='text/html; charset=utf-8'</span><span class="k">&gt;</span>
<span class="k">&lt;/</span><span class="i">head</span><span class="k">&gt;</span>
<span class="k">&lt;</span><span class="i">body</span><span class="k">&gt;</span>
    <span class="k">&lt;</span><span class="i">div</span> <span class="o">id</span><span class="k">='sample'</span><span class="k">&gt;&lt;/</span><span class="i">div</span><span class="k">&gt;</span>
  <span class="k">&lt;</span><span class="i">script</span> <span class="o">src</span><span class="k">="bundle.js"</span><span class="k">&gt;&lt;/</span><span class="i">script</span><span class="k">&gt;</span>
<span class="k">&lt;/</span><span class="i">body</span><span class="k">&gt;</span>
<span class="k">&lt;/</span><span class="i">html</span><span class="k">&gt;</span>
</code></pre></td></tr></table>
<h1>Configuration</h1>
<p>First step is creating configuration for Fable compiler. It's done by creating <code>fableconfig.json</code> file.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
</pre></td>
<td class="snippet"><pre class="fssnip"><code lang="json">{
    "module": "commonjs",
    "sourceMaps": true,
    "projFile": "./src/code.fsx",
    "outDir": "temp",
    "scripts": {
        "prebuild": "npm install",
        "postbuild": "webpack"
    },
    "targets": {
        "watch": {
            "scripts": {
                "postbuild": "webpack --watch"
            }
        }
    }
}
</code></pre></td></tr></table>
<p>First we define module type - in our case it's <code>commonjs</code> (as it's working well with <code>Webpack</code>). Next we define that we want to use soruce maps (it allows F# file debugging), entry point of application, and output directory for compiled JS files.
Next step is defining some small scripts which will be run before and after every build - before we want to run <code>npm install</code> to restore all dependencies, after build we run <code>webpack</code> to create bundled output file. Last part defines additional target which will be executed in <code>watch</code> mode. In such case we want to run <code>webpack</code> also in <code>watch</code> mode.</p>
<blockquote>
<p><code>watch</code> mode will make Fable and Webpack to recompile project after every file save without need to execute any additional commands.</p>
</blockquote>
<h3>Webpack configuration</h3>
<p>Second step is to create <code>webpack</code> configuration. Let's create <code>webpack.config.js</code> file:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="js"><span class="k">var</span> path <span class="o">=</span> require(<span class="s">"path"</span>);
<span class="k">var</span> webpack <span class="o">=</span> require(<span class="s">"webpack"</span>);

<span class="k">var</span> cfg <span class="o">=</span> {
  devtool: <span class="s">"source-map"</span>,
  entry: <span class="s">"./temp/code.js"</span>,
  output: {
    path: path.join(__dirname, <span class="s">"public"</span>),
    filename: <span class="s">"bundle.js"</span>
  },
  module: {
    preLoaders: [
      {
        test: <span class="o">/</span>\.js$<span class="o">/</span>,
        exclude: /node_modules/,
        loader: <span class="s">"source-map-loader"</span>
      }
    ]
  }
};

module.exports <span class="o">=</span> cfg;
</code></pre></td></tr></table>
<p>In this file we define that we want to use source maps, entry point for webpack ( so file generated by Fable), output path, and usage of any additional plugins (in our case it will be <code>source-map-loader</code> installed before)</p>
<h3>Npm scripts</h3>
<p>Easiest way to run tools installed by <code>npm</code> is by using scripts section in <code>packages.json</code> file. Let's put there following scripts:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip"><code lang="json">"scripts": {
    "build": "fable",
    "watch": "fable -w --target watch"
  },
</code></pre></td></tr></table>
<p><code>build</code> just starts Fable. <code>watch</code>, as name suggests, starts Fable in <code>watch</code> mode, so code is regenerated every time we save F# file. We can run those scripts using <code>npm run &lt;script_name&gt;</code> command.</p>
<h3>VSCode configuration</h3>
<p>Last, optional step is creating <a href="https://code.visualstudio.com/">VSCode</a> configuration. It's fairly easy since editor has decent integration with <code>npm</code>. All we need to do is create <code>.vscode\tasks.json</code> file and put there following code:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
</pre></td>
<td class="snippet"><pre class="fssnip"><code lang="json">{
    "version": "0.1.0",
    "command": "npm",
    "isShellCommand": true,
    "showOutput": "always",
    "suppressTaskName": true,
    "tasks": [
        {
            "taskName": "install",
            "args": ["install"]
        },
        {
            "taskName": "build",
            "args": ["run", "build"],
            "isBuildCommand": true
        },
        {
            "taskName": "watch",
            "args": ["run", "watch"],
            "isWatching": true
        }
    ]
}
</code></pre></td></tr></table>
<p>Here we define that our tasks are using <code>npm</code> and we define arguments send to <code>npm</code> with every task.
We can run those task usign <code>Tasks: Run Task</code> command (<code>build</code> task can be also run using <code>Tasks: Run Build Command</code> command or <code>Ctrl + Shift + B</code>)</p>
<h1>Summary</h1>
<p>In this post we have shortly moved all steps necessary to create browser, client-side applications using F#, Fable and Webpack. Whole source code of this sample application is on GitHub - <a href="https://github.com/Krzysztof-Cieslak/fable-webpack-demo">https://github.com/Krzysztof-Cieslak/fable-webpack-demo</a></p>


<div class="tip" id="fs1">namespace Microsoft.FSharp.Core</div>
<div class="tip" id="fs2">val ignore : value:&#39;T -&gt; unit<br /><br />Full name: Microsoft.FSharp.Core.Operators.ignore</div>
